<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><meta charset="UTF-8"><meta name="description" content="Amp Examples and Guides"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><title>undefined - Examples</title><style>[data-astro-cid-37fxchfa]{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;color:#333;background-color:#fff}nav[data-astro-cid-37fxchfa]{background:#f8f9fa;border-bottom:1px solid #e9ecef;padding:1rem 0}.nav-container[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center}.logo[data-astro-cid-37fxchfa]{font-weight:600;font-size:1.2rem;color:#06c;text-decoration:none}.nav-links[data-astro-cid-37fxchfa]{display:flex;gap:2rem}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#333;text-decoration:none;font-weight:500}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]:hover{color:#06c}main[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:2rem;min-height:calc(100vh - 160px)}footer[data-astro-cid-37fxchfa]{background:#f8f9fa;border-top:1px solid #e9ecef;padding:2rem 0;text-align:center;color:#666}footer[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#06c}
.example-header[data-astro-cid-snxq2g6g]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e9ecef}.breadcrumb[data-astro-cid-snxq2g6g]{color:#666;font-size:.9rem;margin-bottom:1rem}.breadcrumb[data-astro-cid-snxq2g6g] a[data-astro-cid-snxq2g6g]{color:#06c;text-decoration:none}.breadcrumb[data-astro-cid-snxq2g6g] a[data-astro-cid-snxq2g6g]:hover{text-decoration:underline}.example-header[data-astro-cid-snxq2g6g] h1[data-astro-cid-snxq2g6g]{color:#333;font-size:2rem;margin-bottom:1rem}.description[data-astro-cid-snxq2g6g]{color:#666;font-size:1.1rem;line-height:1.6;margin-bottom:1.5rem}.metadata[data-astro-cid-snxq2g6g]{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}.thread-link[data-astro-cid-snxq2g6g]{background:#06c;color:#fff;padding:.5rem 1rem;border-radius:4px;text-decoration:none;font-size:.875rem;font-weight:500;transition:background-color .2s ease}.thread-link[data-astro-cid-snxq2g6g]:hover{background:#0052a3}.tags[data-astro-cid-snxq2g6g]{display:flex;gap:.5rem;flex-wrap:wrap}.tag[data-astro-cid-snxq2g6g]{background:#f5f5f5;color:#666;padding:.25rem .5rem;border-radius:3px;font-size:.75rem}.example-content[data-astro-cid-snxq2g6g]{max-width:none;line-height:1.7}.example-content[data-astro-cid-snxq2g6g] h2{color:#333;font-size:1.5rem;margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:1px solid #e9ecef}.example-content[data-astro-cid-snxq2g6g] h3{color:#333;font-size:1.25rem;margin:1.5rem 0 .75rem}.example-content[data-astro-cid-snxq2g6g] p{margin-bottom:1rem;color:#444}.example-content[data-astro-cid-snxq2g6g] code{background:#f8f9fa;padding:.125rem .25rem;border-radius:3px;font-size:.875rem}.example-content[data-astro-cid-snxq2g6g] pre{background:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:1rem;overflow-x:auto;margin:1rem 0}.example-content[data-astro-cid-snxq2g6g] ul,.example-content[data-astro-cid-snxq2g6g] ol{padding-left:2rem;margin-bottom:1rem}.example-content[data-astro-cid-snxq2g6g] li{margin-bottom:.5rem}.example-content[data-astro-cid-snxq2g6g] blockquote{border-left:4px solid #0066cc;margin:1rem 0;padding:.5rem 1rem;background:#f8f9fa;color:#666}.example-content[data-astro-cid-snxq2g6g] table{width:100%;border-collapse:collapse;margin:1rem 0}.example-content[data-astro-cid-snxq2g6g] th,.example-content[data-astro-cid-snxq2g6g] td{border:1px solid #e9ecef;padding:.75rem;text-align:left}.example-content[data-astro-cid-snxq2g6g] th{background:#f8f9fa;font-weight:600}
</style></head> <body data-astro-cid-37fxchfa> <nav data-astro-cid-37fxchfa> <div class="nav-container" data-astro-cid-37fxchfa> <a href="/" class="logo" data-astro-cid-37fxchfa>Amp Examples & Guides</a> <div class="nav-links" data-astro-cid-37fxchfa> <a href="/guides" data-astro-cid-37fxchfa>Guides</a> <a href="/examples" data-astro-cid-37fxchfa>Examples</a> </div> </div> </nav> <main data-astro-cid-37fxchfa>  <div class="example-header" data-astro-cid-snxq2g6g> <nav class="breadcrumb" data-astro-cid-snxq2g6g> <a href="/" data-astro-cid-snxq2g6g>Home</a> / <a href="/examples" data-astro-cid-snxq2g6g>Examples</a> /  </nav> <h1 data-astro-cid-snxq2g6g></h1> <p class="description" data-astro-cid-snxq2g6g></p> <div class="metadata" data-astro-cid-snxq2g6g>   </div> </div> <div class="example-content" data-astro-cid-snxq2g6g> <h1 id="parallel-worktree-sonarqube-processor">Parallel Worktree SonarQube Processor</h1>
<h2 id="advanced-high-performance-approach-for-concurrent-issue-processing">Advanced, high-performance approach for concurrent issue processing</h2>
<p>This implementation uses git worktrees to process multiple SonarQube issues concurrently, providing maximum efficiency for large-scale automation.</p>
<h2 id="how-it-works">How It Works</h2>
<ol>
<li><strong>Fetches issues</strong> from SonarQube organization using MCP tools</li>
<li><strong>Auto-clones repositories</strong> that don’t exist locally</li>
<li><strong>Creates git worktrees</strong> for isolated issue processing</li>
<li><strong>Processes multiple issues concurrently</strong> (configurable, default: 3 per repo)</li>
<li><strong>Spawns Amp CLI threads</strong> to fix issues with AI assistance</li>
<li><strong>Creates pull requests</strong> via GitHub CLI</li>
</ol>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Organization-based filtering</strong>: Only processes issues from your specified SonarQube organization</li>
<li><strong>Multi-repo support</strong>: Automatically clones and processes issues across multiple repositories</li>
<li><strong>Concurrent processing</strong>: Handles multiple issues per repository using git worktrees</li>
<li><strong>SonarQube integration</strong>: Fetches real issues from your SonarQube instance</li>
<li><strong>PR automation</strong>: Creates pull requests with proper titles and descriptions</li>
<li><strong>Progress tracking</strong>: Comprehensive logging and progress reporting</li>
<li><strong>Configurable paths</strong>: Uses environment variables for flexible deployment</li>
</ul>
<h2 id="when-to-use-this-approach">When to Use This Approach</h2>
<p><strong>Perfect for:</strong></p>
<ul>
<li>Processing 10+ issues across multiple repositories</li>
<li>High-volume automation scenarios</li>
<li>When time efficiency is critical</li>
<li>Users comfortable with advanced git concepts</li>
</ul>
<p><strong>Requirements:</strong></p>
<ul>
<li>Sufficient disk space for multiple worktrees</li>
<li>Adequate system memory for concurrent processing</li>
<li>Familiarity with git worktrees and concurrent operations</li>
</ul>
<h2 id="download--setup">Download &#x26; Setup</h2>
<ol>
<li><strong>Download the script</strong>: <a href="./amp-sonarqube-worker.ts"><code>amp-sonarqube-worker.ts</code></a></li>
<li><strong>Install dependencies</strong>: <code>npm install -g tsx</code> (for running TypeScript files)</li>
</ol>
<h2 id="quick-start">Quick Start</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Run the processor</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">your-sonar-or</span><span style="color:#E1E4E8">g</span><span style="color:#F97583">></span><span style="color:#79B8FF"> --dry-run</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">your-sonar-or</span><span style="color:#E1E4E8">g</span><span style="color:#F97583">></span></span></code></pre>
<h2 id="prerequisites">Prerequisites</h2>
<p>Ensure you have these tools installed and authenticated:</p>









































<table><thead><tr><th>Tool</th><th>Purpose</th><th>Installation</th><th>Authentication</th></tr></thead><tbody><tr><td><strong>Amp CLI</strong></td><td>AI code analysis and fixing</td><td><code>npm install -g @sourcegraph/amp</code></td><td>Built-in authentication</td></tr><tr><td><strong>GitHub CLI</strong></td><td>Creating pull requests</td><td><code>gh auth login</code></td><td><code>gh auth login</code></td></tr><tr><td><strong>Git</strong></td><td>Repository operations</td><td>System package manager</td><td><code>git config</code> user setup</td></tr><tr><td><strong>Node.js</strong></td><td>Running TypeScript</td><td>nodejs.org</td><td>Not required</td></tr><tr><td><strong>SonarQube MCP</strong></td><td>Fetching issues</td><td>See MCP setup below</td><td>Token-based</td></tr></tbody></table>
<h2 id="usage">Usage</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Process all issues from your SonarQube organization (default: 3 concurrent per repo)</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">sonar-or</span><span style="color:#E1E4E8">g</span><span style="color:#F97583">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Process specific projects with custom concurrency</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">sonar-or</span><span style="color:#E1E4E8">g</span><span style="color:#F97583">></span><span style="color:#9ECBFF"> "project1,project2"</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">max-concurrent-per-rep</span><span style="color:#E1E4E8">o</span><span style="color:#F97583">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Dry run - see what would be processed without making changes</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">sonar-or</span><span style="color:#E1E4E8">g</span><span style="color:#F97583">></span><span style="color:#79B8FF"> --dry-run</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Show help</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#79B8FF"> --help</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Examples</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#9ECBFF"> isuru-f-1</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#9ECBFF"> isuru-f-1</span><span style="color:#9ECBFF"> "my-app,my-api"</span><span style="color:#79B8FF"> 5</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#9ECBFF"> isuru-f-1</span><span style="color:#79B8FF"> --dry-run</span></span></code></pre>
<h3 id="parameters">Parameters</h3>
<ul>
<li><code>&#x3C;sonar-org></code>: <strong>Required</strong> - Your SonarQube organization name (e.g., “isuru-f-1”)</li>
<li><code>"project1,project2"</code>: <strong>Optional</strong> - Comma-separated list of specific project keys to process</li>
<li><code>&#x3C;max-concurrent-per-repo></code>: <strong>Optional</strong> - Maximum concurrent issues per repository (default: 3)</li>
</ul>
<h3 id="options">Options</h3>
<ul>
<li><code>--dry-run</code>: Show what would be processed without making any changes</li>
<li><code>--help, -h</code>: Display help information and usage examples</li>
</ul>
<h3 id="example-pr-output">Example PR Output</h3>
<p>Example PRs created by this script:
<img src="/images/sonarqube-prs.png" alt="alt text"></p>
<p>Example progress files created by this script:
<img src="/images/sonarqube-progress-files.png" alt="alt text"></p>
<p>In the event a file is skipped,started,completed or blocked you can see the progress files in the <code>./output/</code> directory.
Each issue is tracked in it’s own file in the <code>./output/</code> directory with the SonarQube issue key as the filename.</p>
<h2 id="configuration">Configuration</h2>
<p>The script supports flexible configuration through the <code>CONFIG</code> object at the top of the file. Simply edit these values in <code>amp-sonarqube-worker.ts</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> CONFIG</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">	// Directory where repositories will be cloned</span></span>
<span class="line"><span style="color:#E1E4E8">	baseRepoPath: </span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(process.</span><span style="color:#B392F0">cwd</span><span style="color:#E1E4E8">(), </span><span style="color:#9ECBFF">'repos'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Directory where progress files will be written  </span></span>
<span class="line"><span style="color:#E1E4E8">	outputPath: </span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(process.</span><span style="color:#B392F0">cwd</span><span style="color:#E1E4E8">(), </span><span style="color:#9ECBFF">'output'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Temporary directory for git worktrees</span></span>
<span class="line"><span style="color:#E1E4E8">	worktreeParentDir: </span><span style="color:#B392F0">tmpdir</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Maximum number of concurrent issues to process per repository</span></span>
<span class="line"><span style="color:#E1E4E8">	maxConcurrentPerRepo: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Timeout for Amp CLI operations in milliseconds (5 minutes)</span></span>
<span class="line"><span style="color:#E1E4E8">	ampTimeout: </span><span style="color:#79B8FF">300000</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>You can also override these settings with environment variables if needed:</p>



































<table><thead><tr><th>Environment Variable</th><th>Purpose</th><th>Default Value</th></tr></thead><tbody><tr><td><code>REPOS_DIR</code></td><td>Directory where repositories are cloned</td><td><code>./repos</code></td></tr><tr><td><code>OUTPUT_DIR</code></td><td>Directory where progress files are written</td><td><code>./output</code></td></tr><tr><td><code>WORKTREE_PARENT_DIR</code></td><td>Temporary directory for git worktrees</td><td>System temp directory</td></tr><tr><td><code>MAX_CONCURRENT_PER_REPO</code></td><td>Maximum concurrent issues per repository</td><td><code>3</code></td></tr><tr><td><code>AMP_TIMEOUT_MS</code></td><td>Timeout for Amp CLI operations</td><td><code>300000</code> (5 minutes)</td></tr></tbody></table>
<h3 id="file-structure--output">File Structure &#x26; Output</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>amp-thread-processor/</span></span>
<span class="line"><span>├── repos/                    # Cloned repositories (configurable)</span></span>
<span class="line"><span>│   └── owner-repo-name/     # Individual repository folders</span></span>
<span class="line"><span>├── output/                   # Progress tracking (configurable)</span></span>
<span class="line"><span>│   └── project-name/        # Project-specific progress files</span></span>
<span class="line"><span>│       ├── started-SQ_ISSUE_KEY.md   # Issue processing started</span></span>
<span class="line"><span>│       ├── fixed-SQ_ISSUE_KEY.md     # Successfully resolved + PR created</span></span>
<span class="line"><span>│       ├── failed-SQ_ISSUE_KEY.md    # Failed to fix</span></span>
<span class="line"><span>│       ├── blocked-SQ_ISSUE_KEY.md   # Needs manual intervention</span></span>
<span class="line"><span>│       └── skipped-SQ_ISSUE_KEY.md   # Already has existing fix/PR</span></span>
<span class="line"><span>└── /tmp/worktree-*/         # Temporary git worktrees (configurable)</span></span></code></pre>
<p><strong>Output Files Explained:</strong></p>
<ul>
<li><strong><code>started-SQ_ISSUE_KEY.md</code></strong>: Created when processing begins, contains issue details and real-time progress</li>
<li><strong><code>fixed-SQ_ISSUE_KEY.md</code></strong>: Issue successfully fixed, code committed, PR created</li>
<li><strong><code>failed-SQ_ISSUE_KEY.md</code></strong>: Technical failure (Amp CLI error, git issues, etc.)</li>
<li><strong><code>blocked-SQ_ISSUE_KEY.md</code></strong>: Amp CLI requests manual intervention or human input</li>
<li><strong><code>skipped-SQ_ISSUE_KEY.md</code></strong>: Issue already has existing fix or open PR</li>
</ul>
<p>Each file contains:</p>
<ul>
<li>Issue details (key, severity, message, file, line)</li>
<li>Processing progress with timestamps</li>
<li>Amp CLI output and actions taken</li>
<li>Final status and any error messages</li>
</ul>
<h3 id="sonarqube-mcp-setup">SonarQube MCP Setup</h3>
<p>The script integrates with SonarQube through MCP (Model Context Protocol) tools. To set this up:</p>
<ol>
<li>
<p><strong>Install SonarQube MCP Server</strong> (follow the <a href="https://github.com/SonarSource/sonarqube-mcp-server">setup guide</a>)</p>
</li>
<li>
<p><strong>Configure Amp settings.json</strong> to include the SonarQube MCP server</p>
</li>
</ol>
<p><strong>Note</strong>: If SonarQube MCP is not configured, the script will automatically use demo data for testing purposes.</p>
<p>The script will then automatically:</p>
<ul>
<li>Fetch real projects from your SonarQube organization</li>
<li>Get actual open issues from those projects</li>
<li>Extract repository information from SonarQube data</li>
<li>Clone and process real repositories</li>
</ul>
<h3 id="amp-cli-integration">Amp CLI Integration</h3>
<p>Each issue spawns an Amp CLI thread with a detailed prompt that:</p>
<ul>
<li>Analyzes the specific SonarQube issue</li>
<li>Uses SonarQube MCP tools for additional context</li>
<li>Locates and fixes the problematic code</li>
<li>Commits changes and creates a PR via gh CLI</li>
</ul>
<h2 id="dry-run-vs-live-execution">Dry-Run vs Live Execution</h2>
<h3 id="always-start-with-a-dry-run-first"><strong>Always start with a dry-run first!</strong></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># First, see what would be processed</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> amp-sonarqube-worker.ts</span><span style="color:#9ECBFF"> your-org</span><span style="color:#79B8FF"> --dry-run</span></span></code></pre>
<p><strong>Dry-run mode (<code>--dry-run</code>)</strong>:</p>
<ul>
<li>✅ Fetches real SonarQube issues</li>
<li>✅ Shows detailed summary of what would be processed</li>
<li>✅ Groups issues by project and repository</li>
<li>✅ Shows severity breakdown</li>
<li>❌ <strong>No repositories cloned</strong></li>
<li>❌ <strong>No files modified</strong></li>
<li>❌ <strong>No PRs created</strong></li>
<li>❌ <strong>No git operations performed</strong></li>
</ul>
<p><strong>Live execution</strong> (without <code>--dry-run</code>):</p>
<ul>
<li>✅ Fetches SonarQube issues</li>
<li>✅ <strong>Clones repositories</strong> to <code>./repos/</code> directory</li>
<li>✅ <strong>Creates git worktrees</strong> for isolated processing</li>
<li>✅ <strong>Spawns Amp CLI</strong> to analyze and fix issues</li>
<li>✅ <strong>Creates git branches</strong> like <code>fix/sonar-&#x3C;issue-key></code></li>
<li>✅ <strong>Commits changes</strong> with descriptive messages</li>
<li>✅ <strong>Creates pull requests</strong> using GitHub CLI</li>
<li>✅ <strong>Writes progress files</strong> to <code>./output/&#x3C;project>/</code></li>
</ul>
<h2 id="example-workflow">Example Workflow</h2>
<p><strong>Live execution steps:</strong></p>
<ol>
<li>Script fetches SonarQube issues for specified projects</li>
<li>Groups issues by repository</li>
<li><strong>Clears previous output</strong> for each project in <code>./output/</code></li>
<li><strong>Clones missing repositories</strong> to <code>./repos/</code> directory</li>
<li>For each issue:
<ul>
<li><strong>Creates progress file</strong>: <code>./output/&#x3C;project>/started-&#x3C;issue-key>.md</code></li>
<li><strong>Creates git worktree</strong> for isolation</li>
<li><strong>Creates new branch</strong>: <code>fix/sonar-&#x3C;issue-key></code></li>
<li><strong>Spawns Amp CLI</strong> with detailed issue-specific prompt</li>
<li><strong>Amp analyzes, fixes, commits</strong> the changes</li>
<li><strong>Creates pull request</strong> via GitHub CLI</li>
<li><strong>Updates progress file</strong>: renamed to <code>fixed-&#x3C;issue-key>.md</code>, <code>failed-&#x3C;issue-key>.md</code>, etc.</li>
<li><strong>Cleans up worktree</strong></li>
</ul>
</li>
</ol>
<h2 id="architecture">Architecture</h2>
<ul>
<li><strong>ThreadProcessor</strong>: Main class handling issue processing</li>
<li><strong>SonarIssue</strong>: Interface for issue data structure</li>
<li><strong>RepoInfo</strong>: Interface for repository information</li>
<li><strong>Git worktrees</strong>: Enable concurrent processing on same repo</li>
<li><strong>Concurrent execution</strong>: Limited per-repo to avoid conflicts</li>
</ul>
<h2 id="logging">Logging</h2>
<p>Comprehensive logging includes:</p>
<ul>
<li>Issue fetching progress</li>
<li>Repository cloning/updating status</li>
<li>Worktree creation/cleanup</li>
<li>Amp CLI execution details</li>
<li>PR creation results</li>
<li>Summary statistics</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<ul>
<li>Graceful handling of missing repositories</li>
<li>Automatic worktree cleanup on failures</li>
<li>Detailed error logging with context</li>
<li>Process isolation prevents failures from affecting other issues</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<h3 id="amp-cli-is-not-working-properly">”Amp CLI is not working properly”</h3>
<ul>
<li>Ensure Amp CLI is installed: <code>npm install -g @sourcegraph/amp</code></li>
<li>Test manually: <code>amp -x "Hello, test message"</code></li>
<li>Check for latest version: <code>npm update -g @sourcegraph/amp</code></li>
</ul>
<h3 id="sonarqube-mcp-tools-not-available">”SonarQube MCP tools not available”</h3>
<ul>
<li>Verify SonarQube MCP server is installed and configured</li>
<li>Check your Amp settings.json includes the SonarQube MCP configuration</li>
<li>Test MCP connection: <code>amp -x "Use mcp__sonarqube__search_my_sonarqube_projects tool"</code></li>
</ul>
<h3 id="permission-denied-or-ssh-errors">”Permission denied” or SSH errors</h3>
<ul>
<li>Ensure GitHub CLI is authenticated: <code>gh auth login</code></li>
<li>For private repositories, verify your GitHub token has appropriate permissions</li>
<li>Check SSH keys are configured: <code>ssh -T git@github.com</code></li>
</ul>
<h3 id="worktree-creation-failed">”Worktree creation failed”</h3>
<ul>
<li>Ensure the worktree parent directory is writable</li>
<li>Check disk space in the configured temp directory</li>
<li>Verify git is properly installed and configured</li>
</ul>
<h3 id="process-hangs-or-times-out">Process hangs or times out</h3>
<ul>
<li>Increase the timeout by editing <code>ampTimeout</code> in the CONFIG object</li>
<li>Check network connectivity to GitHub and SonarQube</li>
<li>Monitor system resources (CPU, memory, disk)</li>
</ul> </div>  </main> <footer data-astro-cid-37fxchfa> <p data-astro-cid-37fxchfa>© 2024 Sourcegraph. Supplemental to the <a href="https://ampcode.com/manual" data-astro-cid-37fxchfa>Amp Manual</a>.</p> </footer> </body></html> 