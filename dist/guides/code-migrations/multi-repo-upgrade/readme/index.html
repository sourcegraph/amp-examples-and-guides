<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><meta charset="UTF-8"><meta name="description" content="Amp Examples and Guides"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><title>undefined - Guides</title><style>[data-astro-cid-37fxchfa]{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;color:#333;background-color:#fff}nav[data-astro-cid-37fxchfa]{background:#f8f9fa;border-bottom:1px solid #e9ecef;padding:1rem 0}.nav-container[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center}.logo[data-astro-cid-37fxchfa]{font-weight:600;font-size:1.2rem;color:#06c;text-decoration:none}.nav-links[data-astro-cid-37fxchfa]{display:flex;gap:2rem}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#333;text-decoration:none;font-weight:500}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]:hover{color:#06c}main[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:2rem;min-height:calc(100vh - 160px)}footer[data-astro-cid-37fxchfa]{background:#f8f9fa;border-top:1px solid #e9ecef;padding:2rem 0;text-align:center;color:#666}footer[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#06c}
.guide-header[data-astro-cid-oolc5s6i]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e9ecef}.breadcrumb[data-astro-cid-oolc5s6i]{color:#666;font-size:.9rem;margin-bottom:1rem}.breadcrumb[data-astro-cid-oolc5s6i] a[data-astro-cid-oolc5s6i]{color:#06c;text-decoration:none}.breadcrumb[data-astro-cid-oolc5s6i] a[data-astro-cid-oolc5s6i]:hover{text-decoration:underline}.guide-header[data-astro-cid-oolc5s6i] h1[data-astro-cid-oolc5s6i]{color:#333;font-size:2rem;margin-bottom:1rem}.description[data-astro-cid-oolc5s6i]{color:#666;font-size:1.1rem;line-height:1.6;margin-bottom:1.5rem}.metadata[data-astro-cid-oolc5s6i]{display:flex;gap:1rem;flex-wrap:wrap}.phase-badge[data-astro-cid-oolc5s6i]{display:inline-block;padding:.25rem .5rem;border-radius:3px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.phase-plan[data-astro-cid-oolc5s6i]{background:#e3f2fd;color:#1565c0}.phase-build[data-astro-cid-oolc5s6i]{background:#f3e5f5;color:#7b1fa2}.phase-deploy[data-astro-cid-oolc5s6i]{background:#e8f5e8;color:#2e7d32}.phase-support[data-astro-cid-oolc5s6i]{background:#fff3e0;color:#f57c00}.category-badge[data-astro-cid-oolc5s6i]{background:#f5f5f5;color:#666;padding:.25rem .5rem;border-radius:3px;font-size:.75rem}.guide-content[data-astro-cid-oolc5s6i]{max-width:none;line-height:1.7}.guide-content[data-astro-cid-oolc5s6i] h2{color:#333;font-size:1.5rem;margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:1px solid #e9ecef}.guide-content[data-astro-cid-oolc5s6i] h3{color:#333;font-size:1.25rem;margin:1.5rem 0 .75rem}.guide-content[data-astro-cid-oolc5s6i] p{margin-bottom:1rem;color:#444}.guide-content[data-astro-cid-oolc5s6i] code{background:#f8f9fa;padding:.125rem .25rem;border-radius:3px;font-size:.875rem}.guide-content[data-astro-cid-oolc5s6i] pre{background:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:1rem;overflow-x:auto;margin:1rem 0}.guide-content[data-astro-cid-oolc5s6i] ul,.guide-content[data-astro-cid-oolc5s6i] ol{padding-left:2rem;margin-bottom:1rem}.guide-content[data-astro-cid-oolc5s6i] li{margin-bottom:.5rem}.guide-content[data-astro-cid-oolc5s6i] blockquote{border-left:4px solid #0066cc;margin:1rem 0;padding:.5rem 1rem;background:#f8f9fa;color:#666}.guide-content[data-astro-cid-oolc5s6i] table{width:100%;border-collapse:collapse;margin:1rem 0}.guide-content[data-astro-cid-oolc5s6i] th,.guide-content[data-astro-cid-oolc5s6i] td{border:1px solid #e9ecef;padding:.75rem;text-align:left}.guide-content[data-astro-cid-oolc5s6i] th{background:#f8f9fa;font-weight:600}
</style></head> <body data-astro-cid-37fxchfa> <nav data-astro-cid-37fxchfa> <div class="nav-container" data-astro-cid-37fxchfa> <a href="/" class="logo" data-astro-cid-37fxchfa>Amp Examples & Guides</a> <div class="nav-links" data-astro-cid-37fxchfa> <a href="/guides" data-astro-cid-37fxchfa>Guides</a> <a href="/examples" data-astro-cid-37fxchfa>Examples</a> </div> </div> </nav> <main data-astro-cid-37fxchfa>  <div class="guide-header" data-astro-cid-oolc5s6i> <nav class="breadcrumb" data-astro-cid-oolc5s6i> <a href="/" data-astro-cid-oolc5s6i>Home</a> / <a href="/guides" data-astro-cid-oolc5s6i>Guides</a> /  </nav> <h1 data-astro-cid-oolc5s6i></h1> <p class="description" data-astro-cid-oolc5s6i></p> <div class="metadata" data-astro-cid-oolc5s6i>   </div> </div> <div class="guide-content" data-astro-cid-oolc5s6i> <h1 id="multi-repository-upgrade-with-amp">Multi-Repository Upgrade with Amp</h1>
<p>Upgrade multiple repositories simultaneously using Amp’s parallel processing with AI-guided planning and execution.</p>
<h2 id="quick-overview">Quick Overview</h2>
<p><img src="/images/migration-diagram.png" alt="Multi-Repository Migration Flow"></p>
<p><strong>Two phases</strong>: Plan the migration → Execute across repositories<br>
<strong>Result</strong>: Automated PRs with tested upgrades across all your repos</p>
<h2 id="when-to-use-this-approach">When to Use This Approach</h2>
<p>This method works best when you have:</p>
<h3 id="ideal-scenarios"><strong>Ideal Scenarios</strong></h3>
<ul>
<li><strong>Local Repository Access</strong>: All target repositories are cloned locally</li>
<li><strong>Local Build Capability</strong>: You can compile and build projects on your machine</li>
<li><strong>Small to Medium Scale</strong>: Upgrading small-medium number of repositories (varies by API limits and machine resources)</li>
<li><strong>Standard Migrations</strong>: Framework upgrades, dependency updates, configuration changes that are well documented</li>
</ul>
<h3 id="api-limit-considerations"><strong>API Limit Considerations</strong></h3>
<ul>
<li><strong>Code Host Limits</strong>: GitHub/GitLab API limits vary by plan and setup</li>
<li><strong>Limited Interactions</strong>: Only hits APIs for cloning/fetching and creating PRs</li>
<li><strong>Retry Capability</strong>: If you hit limits, ask Amp to retry later</li>
</ul>
<h3 id="not-suitable-for"><strong>Not Suitable For</strong></h3>
<ul>
<li>Repositories you can’t build locally (.NET 4 project on Mac OS host)</li>
<li>Complex migrations requiring manual intervention</li>
<li>Very large scale (1000s+ repositories) without enterprise API limits</li>
<li>Migrations requiring external service coordination</li>
</ul>
<h2 id="your-first-migration">Your First Migration</h2>
<h3 id="step-1-prerequisites-checklist">Step 1: Prerequisites Checklist</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> Amp CLI or VS Code extension installed</li>
<li class="task-list-item"><input type="checkbox" disabled> GitHub/GitLab CLI logged in with write access</li>
<li class="task-list-item"><input type="checkbox" disabled> Target repositories cloned locally in one directory (you can ask Amp to do this)</li>
<li class="task-list-item"><input type="checkbox" disabled> Migration documentation URL ready</li>
</ul>
<h3 id="step-2-use-the-example-migration-template">Step 2: Use the example Migration Template</h3>
<p>Copy this template and replace the <code>{variables}</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>Analyze all projects in this folder and create a migration plan to upgrade from {PURPOSE}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Requirements:</span></span>
<span class="line"><span>- Generate a detailed spec plan in {SPEC_FILENAME}.md</span></span>
<span class="line"><span>- Use subagents for execution</span></span>
<span class="line"><span>- Build and test projects before migration</span></span>
<span class="line"><span>- Execute the migration</span></span>
<span class="line"><span>- Build and test projects after migration</span></span>
<span class="line"><span>- Document all results</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Reference: {MIGRATION_URL}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Output Requirements:</span></span>
<span class="line"><span>Create {PROGRESS_FILENAME}.md with:</span></span>
<span class="line"><span>- Build status (before/after)</span></span>
<span class="line"><span>- Branch name and commit messages</span></span>
<span class="line"><span>- Migration steps executed</span></span>
<span class="line"><span>- Any issues encountered including blockers</span></span>
<span class="line"><span>- Summary of what was changed and why</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Use GitHub CLI to create a pull request</span></span>
<span class="line"><span>Include build verification results in PR description</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Do not start the migration yet, only generate the spec plan.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Once completed ask the oracle to review your plan and adjust the spec based on the oracle's advice.</span></span></code></pre>
<h3 id="step-3-fill-in-your-variables">Step 3: Fill in Your Variables</h3>
<p><strong>Example - React Upgrade:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>{PURPOSE}: React 17 to React 18</span></span>
<span class="line"><span>{SPEC_FILENAME}: react-18-upgrade</span></span>
<span class="line"><span>{PROGRESS_FILENAME}: react-migration-progress</span></span>
<span class="line"><span>{MIGRATION_URL}: https://react.dev/blog/2022/03/29/react-v18</span></span></code></pre>
<h3 id="step-4-review-and-execute">Step 4: Review and Execute</h3>
<ol>
<li><strong>Generate Plan</strong>: Amp analyzes your repositories and creates migration plan</li>
<li><strong>AI Review</strong>: AI reviewer validates and optimizes the plan</li>
<li><strong>Your Review</strong>: Confirm the plan looks correct</li>
<li><strong>Execute</strong>: Amp deploys parallel workers to upgrade each repository</li>
<li><strong>Monitor</strong>: Track progress and review created PRs</li>
</ol>
<h2 id="real-example">Real Example</h2>
<p><strong>Migration</strong>: <a href="https://ampcode.com/threads/T-e5f31274-832a-492f-b50e-63908d25c411">System.Data.SqlClient to Microsoft.Data.SqlClient</a></p>
<p><strong>Template Variables Used:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>{PURPOSE}: System.Data.SqlClient to Microsoft.Data.SqlClient</span></span>
<span class="line"><span>{SPEC_FILENAME}: sqldata-migration</span></span>
<span class="line"><span>{PROGRESS_FILENAME}: progress</span></span>
<span class="line"><span>{MIGRATION_URL}: https://github.com/dotnet/SqlClient/blob/main/porting-cheat-sheet.md</span></span></code></pre>
<p><strong>Result Amp Output from VS Code</strong>: <img src="/images/multi-repo-upgrade-output.png" alt="15 repositories upgraded with automated PRs"></p>
<p><strong>Sample PR</strong>: <a href="https://github.com/amp-example-org/bank-app-15/pull/1">https://github.com/amp-example-org/bank-app-15/pull/1</a></p>
<h2 id="understanding-the-process">Understanding the Process</h2>
<h3 id="phase-1-planning">Phase 1: Planning</h3>
<ol>
<li><strong>Repository Analysis</strong>: Amp scans all local repositories for current versions and dependencies</li>
<li><strong>Migration Plan</strong>: Creates detailed upgrade strategy based on official documentation</li>
<li><strong>AI Review</strong>: AI reviewer identifies potential issues and optimizes the approach</li>
<li><strong>Your Approval</strong>: You review and confirm the plan before execution</li>
</ol>
<h3 id="phase-2-execution">Phase 2: Execution</h3>
<ol>
<li><strong>Parallel Workers</strong>: Amp creates one worker per repository</li>
<li><strong>For Each Repository</strong>:
<ul>
<li>Create feature branch (<code>feature/migrate-{framework}-{version}</code>)</li>
<li>Apply upgrades (dependencies, code changes, configs)</li>
<li>Run tests and builds</li>
<li>Create PR with results</li>
</ul>
</li>
</ol>
<h3 id="what-amp-does-automatically">What Amp Does Automatically</h3>
<ul>
<li><strong>Dependency Analysis</strong>: Identifies which files need updating</li>
<li><strong>Breaking Change Detection</strong>: Reviews migration docs for potential issues</li>
<li><strong>Test Validation</strong>: Runs your existing test suite to verify changes</li>
<li><strong>Build Verification</strong>: Ensures projects compile after migration</li>
<li><strong>PR Creation</strong>: Generates detailed pull requests with test results</li>
</ul>
<h3 id="what-you-control">What You Control</h3>
<ul>
<li><strong>Repository Selection</strong>: Choose which repos to include</li>
<li><strong>Migration Scope</strong>: Define what gets upgraded</li>
<li><strong>Success Criteria</strong>: Set requirements for test coverage, build times, etc.</li>
<li><strong>Final Approval</strong>: Review and merge PRs when ready</li>
</ul>
<h2 id="template-variables-reference">Template Variables Reference</h2>






























<table><thead><tr><th>Variable</th><th>Purpose</th><th>Example</th></tr></thead><tbody><tr><td><code>{PURPOSE}</code></td><td>What you’re migrating</td><td><code>"React 17 to React 18"</code></td></tr><tr><td><code>{SPEC_FILENAME}</code></td><td>Name for plan file</td><td><code>"react-18-upgrade"</code></td></tr><tr><td><code>{PROGRESS_FILENAME}</code></td><td>Name for progress file</td><td><code>"migration-progress"</code></td></tr><tr><td><code>{MIGRATION_URL}</code></td><td>Official documentation</td><td><code>"https://react.dev/blog/..."</code></td></tr></tbody></table>
<h2 id="advanced-usage">Advanced Usage</h2>
<details>
<summary>Custom Success Criteria</summary>
<p>Add specific requirements to your template:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>Success criteria:</span></span>
<span class="line"><span>- All tests pass with same coverage (±2%)</span></span>
<span class="line"><span>- Build time increases no more than 20%</span></span>
<span class="line"><span>- No new linting errors introduced</span></span>
<span class="line"><span>- Performance tests within 5% of baseline</span></span></code></pre>
</details>
<details>
<summary>Custom Branch Strategy</summary>
<p>Modify branch naming and strategy:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>Git strategy:</span></span>
<span class="line"><span>- Branch name: feature/react-18-{date}</span></span>
<span class="line"><span>- Base branch: develop (not main)</span></span>
<span class="line"><span>- PR target: staging branch for review</span></span></code></pre>
</details>
<h2 id="best-practices">Best Practices</h2>
<h3 id="before-starting">Before Starting</h3>
<ul>
<li>Test the migration on one repository manually first</li>
<li>Ensure all repositories build successfully locally</li>
<li>Start with smaller, less critical repositories before you scale it out</li>
</ul>
<h3 id="after-migration">After Migration</h3>
<ul>
<li>Review all PRs before merging</li>
<li>Run integration tests across updated repositories</li>
<li>Plan follow-up for any blocked repositories</li>
</ul> </div>  </main> <footer data-astro-cid-37fxchfa> <p data-astro-cid-37fxchfa>© 2024 Sourcegraph. Supplemental to the <a href="https://ampcode.com/manual" data-astro-cid-37fxchfa>Amp Manual</a>.</p> </footer> </body></html> 