<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><meta charset="UTF-8"><meta name="description" content="Amp Examples and Guides"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><title>undefined - Guides</title><style>[data-astro-cid-37fxchfa]{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;color:#333;background-color:#fff}nav[data-astro-cid-37fxchfa]{background:#f8f9fa;border-bottom:1px solid #e9ecef;padding:1rem 0}.nav-container[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center}.logo[data-astro-cid-37fxchfa]{font-weight:600;font-size:1.2rem;color:#06c;text-decoration:none}.nav-links[data-astro-cid-37fxchfa]{display:flex;gap:2rem}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#333;text-decoration:none;font-weight:500}.nav-links[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]:hover{color:#06c}main[data-astro-cid-37fxchfa]{max-width:1200px;margin:0 auto;padding:2rem;min-height:calc(100vh - 160px)}footer[data-astro-cid-37fxchfa]{background:#f8f9fa;border-top:1px solid #e9ecef;padding:2rem 0;text-align:center;color:#666}footer[data-astro-cid-37fxchfa] a[data-astro-cid-37fxchfa]{color:#06c}
.guide-header[data-astro-cid-oolc5s6i]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e9ecef}.breadcrumb[data-astro-cid-oolc5s6i]{color:#666;font-size:.9rem;margin-bottom:1rem}.breadcrumb[data-astro-cid-oolc5s6i] a[data-astro-cid-oolc5s6i]{color:#06c;text-decoration:none}.breadcrumb[data-astro-cid-oolc5s6i] a[data-astro-cid-oolc5s6i]:hover{text-decoration:underline}.guide-header[data-astro-cid-oolc5s6i] h1[data-astro-cid-oolc5s6i]{color:#333;font-size:2rem;margin-bottom:1rem}.description[data-astro-cid-oolc5s6i]{color:#666;font-size:1.1rem;line-height:1.6;margin-bottom:1.5rem}.metadata[data-astro-cid-oolc5s6i]{display:flex;gap:1rem;flex-wrap:wrap}.phase-badge[data-astro-cid-oolc5s6i]{display:inline-block;padding:.25rem .5rem;border-radius:3px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.phase-plan[data-astro-cid-oolc5s6i]{background:#e3f2fd;color:#1565c0}.phase-build[data-astro-cid-oolc5s6i]{background:#f3e5f5;color:#7b1fa2}.phase-deploy[data-astro-cid-oolc5s6i]{background:#e8f5e8;color:#2e7d32}.phase-support[data-astro-cid-oolc5s6i]{background:#fff3e0;color:#f57c00}.category-badge[data-astro-cid-oolc5s6i]{background:#f5f5f5;color:#666;padding:.25rem .5rem;border-radius:3px;font-size:.75rem}.guide-content[data-astro-cid-oolc5s6i]{max-width:none;line-height:1.7}.guide-content[data-astro-cid-oolc5s6i] h2{color:#333;font-size:1.5rem;margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:1px solid #e9ecef}.guide-content[data-astro-cid-oolc5s6i] h3{color:#333;font-size:1.25rem;margin:1.5rem 0 .75rem}.guide-content[data-astro-cid-oolc5s6i] p{margin-bottom:1rem;color:#444}.guide-content[data-astro-cid-oolc5s6i] code{background:#f8f9fa;padding:.125rem .25rem;border-radius:3px;font-size:.875rem}.guide-content[data-astro-cid-oolc5s6i] pre{background:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:1rem;overflow-x:auto;margin:1rem 0}.guide-content[data-astro-cid-oolc5s6i] ul,.guide-content[data-astro-cid-oolc5s6i] ol{padding-left:2rem;margin-bottom:1rem}.guide-content[data-astro-cid-oolc5s6i] li{margin-bottom:.5rem}.guide-content[data-astro-cid-oolc5s6i] blockquote{border-left:4px solid #0066cc;margin:1rem 0;padding:.5rem 1rem;background:#f8f9fa;color:#666}.guide-content[data-astro-cid-oolc5s6i] table{width:100%;border-collapse:collapse;margin:1rem 0}.guide-content[data-astro-cid-oolc5s6i] th,.guide-content[data-astro-cid-oolc5s6i] td{border:1px solid #e9ecef;padding:.75rem;text-align:left}.guide-content[data-astro-cid-oolc5s6i] th{background:#f8f9fa;font-weight:600}
</style></head> <body data-astro-cid-37fxchfa> <nav data-astro-cid-37fxchfa> <div class="nav-container" data-astro-cid-37fxchfa> <a href="/" class="logo" data-astro-cid-37fxchfa>Amp Examples & Guides</a> <div class="nav-links" data-astro-cid-37fxchfa> <a href="/guides" data-astro-cid-37fxchfa>Guides</a> <a href="/examples" data-astro-cid-37fxchfa>Examples</a> </div> </div> </nav> <main data-astro-cid-37fxchfa>  <div class="guide-header" data-astro-cid-oolc5s6i> <nav class="breadcrumb" data-astro-cid-oolc5s6i> <a href="/" data-astro-cid-oolc5s6i>Home</a> / <a href="/guides" data-astro-cid-oolc5s6i>Guides</a> /  </nav> <h1 data-astro-cid-oolc5s6i></h1> <p class="description" data-astro-cid-oolc5s6i></p> <div class="metadata" data-astro-cid-oolc5s6i>   </div> </div> <div class="guide-content" data-astro-cid-oolc5s6i> <h1 id="systemdatasqlclient-to-microsoftdatasqlclient-migration-plan">System.Data.SqlClient to Microsoft.Data.SqlClient Migration Plan</h1>
<h2 id="overview">Overview</h2>
<p>This document outlines the migration plan for upgrading from <code>System.Data.SqlClient</code> to <code>Microsoft.Data.SqlClient</code> across 15 bank application projects (bank-app-1 through bank-app-15).</p>
<p><strong>Migration URL Reference</strong>: <a href="https://github.com/dotnet/SqlClient/blob/main/porting-cheat-sheet.md">https://github.com/dotnet/SqlClient/blob/main/porting-cheat-sheet.md</a></p>
<h2 id="current-state-analysis">Current State Analysis</h2>
<h3 id="project-structure">Project Structure</h3>
<ul>
<li><strong>Projects</strong>: 15 identical .NET Framework 4.8 applications (bank-app-1 to bank-app-15)</li>
<li><strong>Architecture</strong>: 4-tier structure per project:
<ul>
<li><code>AcmeBankApp.Core</code> - Business logic layer</li>
<li><code>AcmeBankApp.Data</code> - Data access layer</li>
<li><code>AcmeBankApp.Web</code> - Presentation/UI layer</li>
<li><code>AcmeBankApp.Tests</code> - Unit testing project</li>
</ul>
</li>
</ul>
<h3 id="current-systemdatasqlclient-usage">Current System.Data.SqlClient Usage</h3>
<h4 id="primary-usage-locations">Primary Usage Locations</h4>
<ol>
<li>
<p><strong>DataHelper.cs</strong> (in each Data project)</p>
<ul>
<li>Direct usage of <code>SqlConnection</code>, <code>SqlCommand</code>, <code>SqlDataAdapter</code>, <code>SqlParameter</code></li>
<li>Line 4: <code>using System.Data.SqlClient;</code></li>
<li>Contains legacy ADO.NET patterns with security vulnerabilities</li>
</ul>
</li>
<li>
<p><strong>AccountService.cs</strong> (in each Data project)</p>
<ul>
<li>Uses System.Data.SqlClient namespace for data operations</li>
</ul>
</li>
<li>
<p><strong>Project Configuration Files</strong>:</p>
<ul>
<li><strong>packages.config</strong>: <code>System.Data.SqlClient</code> version 4.6.0</li>
<li><strong>.csproj files</strong>: Assembly references to System.Data.SqlClient 4.6.0</li>
<li><strong>Web.config/App.config</strong>: Connection string providers</li>
</ul>
</li>
<li>
<p><strong>Test Files</strong>:</p>
<ul>
<li><strong>LegacyDataHelperTests.cs</strong>: Direct SqlParameter usage</li>
</ul>
</li>
</ol>
<h3 id="dependencies-per-project">Dependencies per Project</h3>
<ul>
<li>EntityFramework 6.2.0</li>
<li>System.Data.SqlClient 4.6.0</li>
<li>.NET Framework 4.8</li>
</ul>
<h2 id="revised-migration-strategy-post-oracle-review">REVISED Migration Strategy (Post Oracle Review)</h2>
<h3 id="phase-0-critical-compatibility-resolution-new---required">Phase 0: Critical Compatibility Resolution (NEW - REQUIRED)</h3>
<ol>
<li><strong>Entity Framework Upgrade</strong>: Upgrade EF 6.2.0 â†’ 6.4.4 across all projects</li>
<li><strong>Provider Services Installation</strong>: Add Microsoft.Data.SqlClient.EntityFramework package</li>
<li><strong>DbConfiguration Setup</strong>: Configure provider services registration</li>
<li><strong>Connection String Security</strong>: Update all connection strings with encryption settings</li>
<li><strong>Canary Testing</strong>: Test Phase 0 changes on bank-app-1 only before proceeding</li>
</ol>
<h3 id="phase-1-pre-migration-validation">Phase 1: Pre-Migration Validation</h3>
<ol>
<li><strong>Performance Baseline</strong>: Capture ADO.NET performance counters</li>
<li><strong>Build Verification</strong>: Verify all 15 projects build successfully</li>
<li><strong>Integration Testing</strong>: Add TLS connection health probes</li>
<li><strong>Native Dependencies</strong>: Verify SNI.dll deployment on build agents</li>
</ol>
<h3 id="phase-2-package-migration">Phase 2: Package Migration</h3>
<ol>
<li><strong>Entity Framework Upgrade</strong>: EF 6.2.0 â†’ 6.4.4 (if not done in Phase 0)</li>
<li><strong>Provider Package Installation</strong>: Microsoft.Data.SqlClient + EntityFramework extension</li>
<li><strong>Remove System.Data.SqlClient</strong>: Clean removal from packages.config</li>
<li><strong>Update Project References</strong>: Modify .csproj with new assembly references</li>
</ol>
<h3 id="phase-3-code-migration">Phase 3: Code Migration</h3>
<ol>
<li><strong>Provider Configuration</strong>: Update DbConfiguration and Web.config provider settings</li>
<li><strong>Namespace Updates</strong>: Change using statements to Microsoft.Data.SqlClient</li>
<li><strong>Connection String Updates</strong>: Add Encrypt=false and TrustServerCertificate=true</li>
<li><strong>Assembly Redirects</strong>: Verify AutoGenerateBindingRedirects for crypto dependencies</li>
</ol>
<h3 id="phase-4-enhanced-post-migration-validation">Phase 4: Enhanced Post-Migration Validation</h3>
<ol>
<li><strong>Build Verification</strong>: All projects must build without errors or warnings</li>
<li><strong>Integration Testing</strong>: TLS handshake validation and connection pooling tests</li>
<li><strong>Performance Validation</strong>: Compare performance counters vs baseline (Â±5% tolerance)</li>
<li><strong>Security Scanning</strong>: CodeQL/SonarQube scan for SQL injection patterns</li>
</ol>
<h2 id="detailed-implementation-plan">Detailed Implementation Plan</h2>
<h3 id="files-to-modify-per-project-revised---84-total-files-across-15-projects">Files to Modify Per Project (REVISED - 84+ total files across 15 projects)</h3>
<h4 id="phase-0-entity-framework-upgrade-new---6-files-per-project">Phase 0: Entity Framework Upgrade (NEW - 6 files per project)</h4>
<ol>
<li>
<p><code>AcmeBankApp.Data/packages.config</code></p>
<ul>
<li><strong>Change</strong>: <code>&#x3C;package id="EntityFramework" version="6.2.0" targetFramework="net48" /></code></li>
<li><strong>To</strong>: <code>&#x3C;package id="EntityFramework" version="6.4.4" targetFramework="net48" /></code></li>
<li><strong>Add</strong>: <code>&#x3C;package id="Microsoft.Data.SqlClient.EntityFramework" version="5.0.2" targetFramework="net48" /></code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Data/DbConfiguration.cs</code> (NEW FILE)</p>
<ul>
<li><strong>Create</strong>: Provider services registration class</li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Data/App.config</code></p>
<ul>
<li><strong>Update</strong>: Provider configuration and connection strings</li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Web/packages.config</code></p>
<ul>
<li><strong>Update</strong>: EntityFramework version, add Microsoft.Data.SqlClient packages</li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Web/Web.config</code></p>
<ul>
<li><strong>Update</strong>: Connection strings with encryption parameters</li>
<li><strong>Add</strong>: DbProviderFactories registration</li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Web/AcmeBankApp.Web.csproj</code></p>
<ul>
<li><strong>Add</strong>: AutoGenerateBindingRedirects=true property</li>
</ul>
</li>
</ol>
<h4 id="package-configuration-4-files-per-project">Package Configuration (4 files per project)</h4>
<ol>
<li>
<p><code>AcmeBankApp.Data/packages.config</code></p>
<ul>
<li><strong>Add</strong>: <code>&#x3C;package id="Microsoft.Data.SqlClient" version="5.1.1" targetFramework="net48" /></code></li>
<li><strong>Remove</strong>: <code>&#x3C;package id="System.Data.SqlClient" version="4.6.0" targetFramework="net48" /></code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Web/packages.config</code></p>
<ul>
<li><strong>Add</strong>: <code>&#x3C;package id="Microsoft.Data.SqlClient" version="5.1.1" targetFramework="net48" /></code></li>
<li><strong>Remove</strong>: <code>&#x3C;package id="System.Data.SqlClient" version="4.6.0" targetFramework="net48" /></code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Data/AcmeBankApp.Data.csproj</code></p>
<ul>
<li><strong>Change</strong>: Lines 47-49 System.Data.SqlClient reference</li>
<li><strong>To</strong>: Microsoft.Data.SqlClient reference with updated version and path</li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Web/AcmeBankApp.Web.csproj</code></p>
<ul>
<li><strong>Change</strong>: System.Data.SqlClient reference</li>
<li><strong>To</strong>: Microsoft.Data.SqlClient reference</li>
</ul>
</li>
</ol>
<h4 id="source-code-4-files-per-project">Source Code (4 files per project)</h4>
<ol>
<li>
<p><code>AcmeBankApp.Data/DataHelper.cs</code></p>
<ul>
<li><strong>Change</strong>: <code>using System.Data.SqlClient;</code> (line 4)</li>
<li><strong>To</strong>: <code>using Microsoft.Data.SqlClient;</code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Data/Services/AccountService.cs</code></p>
<ul>
<li><strong>Change</strong>: <code>using System.Data.SqlClient;</code></li>
<li><strong>To</strong>: <code>using Microsoft.Data.SqlClient;</code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Tests/LegacyDataHelperTests.cs</code></p>
<ul>
<li><strong>Change</strong>: <code>using System.Data.SqlClient;</code></li>
<li><strong>To</strong>: <code>using Microsoft.Data.SqlClient;</code></li>
</ul>
</li>
<li>
<p><code>AcmeBankApp.Data/App.config</code></p>
<ul>
<li><strong>Update</strong>: Entity Framework provider configuration</li>
<li><strong>Add</strong>: DbProviderFactories registration and encryption settings</li>
</ul>
</li>
</ol>
<h3 id="migration-commands-revised">Migration Commands (REVISED)</h3>
<h4 id="phase-0-entity-framework-upgrade-per-project">Phase 0: Entity Framework Upgrade (per project)</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="powershell"><code><span class="line"><span style="color:#6A737D"># Navigate to each project directory</span></span>
<span class="line"><span style="color:#E1E4E8">cd bank</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">app</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">{n}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Upgrade Entity Framework first</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> update EntityFramework </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Data </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">Version </span><span style="color:#79B8FF">6.4</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">4</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> update EntityFramework </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Web </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">Version </span><span style="color:#79B8FF">6.4</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install Microsoft.Data.SqlClient.EntityFramework provider</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> install Microsoft.Data.SqlClient.EntityFramework </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">Version </span><span style="color:#79B8FF">5.0</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Data</span></span></code></pre>
<h4 id="nuget-package-updates-per-project">NuGet Package Updates (per project)</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="powershell"><code><span class="line"><span style="color:#6A737D"># Install new SqlClient package (use update instead of uninstall/install)</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> update Microsoft.Data.SqlClient </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">Version </span><span style="color:#79B8FF">5.1</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">1</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Data</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> update Microsoft.Data.SqlClient </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">Version </span><span style="color:#79B8FF">5.1</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">1</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Web</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Remove old package (after new one is installed)</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> uninstall System.Data.SqlClient </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Data</span></span>
<span class="line"><span style="color:#79B8FF">nuget.exe</span><span style="color:#E1E4E8"> uninstall System.Data.SqlClient </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">ProjectName AcmeBankApp.Web</span></span></code></pre>
<h4 id="required-configuration-files-new">Required Configuration Files (NEW)</h4>
<p><strong>DbConfiguration.cs</strong> (Create in AcmeBankApp.Data):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> System</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Entity</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> Microsoft</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Data</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SqlClient</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">EntityFramework</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">[</span><span style="color:#B392F0">DbConfigurationType</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">EfConfig</span><span style="color:#E1E4E8">))]</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> EfConfig</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">DbConfiguration</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> EfConfig</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#B392F0">        SetProviderServices</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient"</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">            SqlProviderServices.Instance);</span></span>
<span class="line"><span style="color:#B392F0">        SetProviderFactory</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            Microsoft.Data.SqlClient.SqlClientFactory.Instance);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>Web.config/App.config Updates</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">connectionStrings</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">add</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"DefaultConnection"</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">       connectionString</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Server=(LocalDB)\MSSQLLocalDB;Database=AcmeBank;Encrypt=false;TrustServerCertificate=true;Integrated Security=true;"</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">       providerName</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">connectionStrings</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">system.data</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">DbProviderFactories</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">add</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient"</span></span>
<span class="line"><span style="color:#B392F0">         invariant</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient"</span></span>
<span class="line"><span style="color:#B392F0">         description</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">".NET Framework Data Provider for SQL Server (Microsoft)"</span></span>
<span class="line"><span style="color:#B392F0">         type</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Microsoft.Data.SqlClient.SqlClientFactory, Microsoft.Data.SqlClient"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">DbProviderFactories</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">system.data</span><span style="color:#E1E4E8">></span></span></code></pre>
<h4 id="build-commands-per-project">Build Commands (per project)</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Restore packages</span></span>
<span class="line"><span style="color:#B392F0">nuget.exe</span><span style="color:#9ECBFF"> restore</span><span style="color:#9ECBFF"> AcmeBankApp.sln</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Build solution with x64 platform for SNI compatibility</span></span>
<span class="line"><span style="color:#B392F0">dotnet</span><span style="color:#9ECBFF"> msbuild</span><span style="color:#9ECBFF"> AcmeBankApp.sln</span><span style="color:#9ECBFF"> /p:Configuration=Debug</span><span style="color:#9ECBFF"> /p:Platform=x64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run tests with x64 platform</span></span>
<span class="line"><span style="color:#B392F0">vstest.console.exe</span><span style="color:#9ECBFF"> AcmeBankApp.Tests</span><span style="color:#79B8FF">\b</span><span style="color:#9ECBFF">in</span><span style="color:#79B8FF">\D</span><span style="color:#9ECBFF">ebug</span><span style="color:#79B8FF">\A</span><span style="color:#9ECBFF">cmeBankApp.Tests.dll</span><span style="color:#79B8FF"> --</span><span style="color:#9ECBFF"> RunConfiguration.TargetPlatform=x64</span></span></code></pre>
<h4 id="performance-baseline-commands">Performance Baseline Commands</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="powershell"><code><span class="line"><span style="color:#6A737D"># Capture ADO.NET performance counters before migration</span></span>
<span class="line"><span style="color:#79B8FF">Get-Counter</span><span style="color:#9ECBFF"> "\\.NET Data Provider for SqlServer(*)\\*"</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">MaxSamples </span><span style="color:#79B8FF">10</span></span></code></pre>
<h2 id="risk-assessment">Risk Assessment</h2>
<h3 id="low-risk-items">Low Risk Items</h3>
<ul>
<li><strong>Namespace Changes</strong>: Simple find/replace operation</li>
<li><strong>API Compatibility</strong>: Microsoft.Data.SqlClient is a drop-in replacement</li>
<li><strong>Connection Strings</strong>: Existing connection strings should work unchanged</li>
</ul>
<h3 id="medium-risk-items">Medium Risk Items</h3>
<ul>
<li><strong>Entity Framework Integration</strong>: Need to verify EF 6.2.0 compatibility</li>
<li><strong>Package Restoration</strong>: Ensure new packages download correctly</li>
<li><strong>Build Configuration</strong>: .csproj reference updates</li>
</ul>
<h3 id="critical-blockers-oracle-review-findings">CRITICAL BLOCKERS (Oracle Review Findings)</h3>
<h3 id="-blocker-1-entity-framework-620-incompatibility">ðŸš¨ BLOCKER 1: Entity Framework 6.2.0 Incompatibility</h3>
<ul>
<li><strong>Issue</strong>: EF 6.2.0 does NOT understand Microsoft.Data.SqlClient provider services</li>
<li><strong>Impact</strong>: EF will silently continue using System.Data.SqlClient from framework</li>
<li><strong>Required Action</strong>: Must upgrade to <strong>Entity Framework 6.4.4</strong> + <strong>Microsoft.Data.SqlClient.EntityFramework</strong></li>
<li><strong>Status</strong>: BLOCKING - Cannot proceed without EF upgrade</li>
</ul>
<h3 id="-blocker-2-breaking-connection-string-changes">ðŸš¨ BLOCKER 2: Breaking Connection String Changes</h3>
<ul>
<li><strong>Issue</strong>: Microsoft.Data.SqlClient 5.x defaults Encrypt=true (was false)</li>
<li><strong>Impact</strong>: Servers without valid TLS certificates will fail to connect</li>
<li><strong>Required Action</strong>: Add explicit connection string parameters</li>
<li><strong>Status</strong>: BLOCKING - Must update all connection strings</li>
</ul>
<h3 id="-blocker-3-native-sni-dependencies">ðŸš¨ BLOCKER 3: Native SNI Dependencies</h3>
<ul>
<li><strong>Issue</strong>: Microsoft.Data.SqlClient requires platform-specific native libraries</li>
<li><strong>Impact</strong>: Build/test agents may fail without proper SNI.dll deployment</li>
<li><strong>Required Action</strong>: Verify native binary deployment in CI/CD</li>
<li><strong>Status</strong>: BLOCKING - Could cause runtime failures</li>
</ul>
<h2 id="potential-additional-issues">Potential Additional Issues</h2>
<ol>
<li><strong>TLS Version Requirements</strong>: Default minimum TLS 1.2 may fail on older SQL Servers</li>
<li><strong>Connection Pooling Changes</strong>: Different idle connection resiliency behavior</li>
<li><strong>Performance Impact</strong>: SNI native path could affect CPU usage</li>
</ol>
<h2 id="quality-assurance-plan">Quality Assurance Plan</h2>
<h3 id="pre-migration-testing">Pre-Migration Testing</h3>
<ol>
<li><strong>Baseline Build</strong>: Verify all 15 projects build successfully</li>
<li><strong>Baseline Tests</strong>: Run all unit tests and document results</li>
<li><strong>Database Connectivity</strong>: Verify database connections work</li>
</ol>
<h3 id="post-migration-testing">Post-Migration Testing</h3>
<ol>
<li><strong>Build Verification</strong>: All projects must build without errors or warnings</li>
<li><strong>Unit Test Execution</strong>: All existing tests must pass</li>
<li><strong>Integration Testing</strong>: Enhanced verification including:
<ul>
<li>TLS handshake validation with Encrypt=false setting</li>
<li>Connection pooling behavior validation</li>
<li>User authentication (ValidateUserLegacy method)</li>
<li>Database queries (ExecuteQuery, ExecuteParameterizedQuery)</li>
<li>Account operations (AccountService functionality)</li>
</ul>
</li>
<li><strong>Performance Testing</strong>: Compare ADO.NET counters vs baseline (Â±5% tolerance)</li>
<li><strong>Security Scanning</strong>: CodeQL scan for SQL injection patterns</li>
</ol>
<h3 id="success-criteria">Success Criteria</h3>
<ul>
<li>âœ… All 15 projects build successfully</li>
<li>âœ… All existing unit tests pass</li>
<li>âœ… No runtime exceptions during basic operations</li>
<li>âœ… Database connectivity maintained</li>
<li>âœ… No performance degradation</li>
</ul>
<h2 id="timeline-and-execution">Timeline and Execution</h2>
<h3 id="automated-execution-strategy">Automated Execution Strategy</h3>
<ol>
<li><strong>Parallel Processing</strong>: Use subagents to handle multiple projects simultaneously</li>
<li><strong>Batch Operations</strong>: Group similar file modifications</li>
<li><strong>Rollback Strategy</strong>: Git branching for easy reversion</li>
</ol>
<h3 id="execution-order">Execution Order</h3>
<ol>
<li><strong>Projects 1-5</strong>: First batch for validation</li>
<li><strong>Projects 6-10</strong>: Second batch after first batch success</li>
<li><strong>Projects 11-15</strong>: Final batch</li>
</ol>
<h3 id="revised-estimated-duration">REVISED Estimated Duration</h3>
<ul>
<li><strong>Phase 0 (EF Upgrade + Canary)</strong>: 2 hours (EF upgrade + bank-app-1 testing)</li>
<li><strong>Phase 1 (Pre-Migration)</strong>: 45 minutes (performance baseline + validation)</li>
<li><strong>Package Updates</strong>: 60 minutes (15 projects Ã— 4 minutes including EF)</li>
<li><strong>Code Changes + Configuration</strong>: 90 minutes (namespace updates + config files)</li>
<li><strong>Enhanced Build &#x26; Test Verification</strong>: 120 minutes (performance validation)</li>
<li><strong>Total</strong>: ~6 hours (increased due to EF upgrade requirements)</li>
</ul>
<h2 id="version-control-strategy">Version Control Strategy</h2>
<h3 id="git-branch-strategy">Git Branch Strategy</h3>
<ul>
<li><strong>Branch Name</strong>: <code>feature/migrate-to-microsoft-data-sqlclient</code></li>
<li><strong>Commit Strategy</strong>:
<ul>
<li>One commit per project for package updates</li>
<li>One commit per project for code changes</li>
<li>Final commit with build verification</li>
</ul>
</li>
</ul>
<h3 id="pull-request-requirements">Pull Request Requirements</h3>
<ul>
<li>Include build verification results</li>
<li>Document any issues encountered</li>
<li>List all modified files</li>
<li>Include test execution summary</li>
</ul>
<h2 id="rollback-plan">Rollback Plan</h2>
<h3 id="if-migration-fails">If Migration Fails</h3>
<ol>
<li><strong>Git Reset</strong>: <code>git checkout main</code> to return to original state</li>
<li><strong>Package Restoration</strong>: <code>nuget restore</code> with original packages.config</li>
<li><strong>Build Verification</strong>: Ensure original state builds correctly</li>
</ol>
<h3 id="partial-failure-handling">Partial Failure Handling</h3>
<ul>
<li>Complete migration on successful projects</li>
<li>Document failed projects and specific issues</li>
<li>Create separate remediation plan for failures</li>
</ul>
<h2 id="success-metrics">Success Metrics</h2>
<h3 id="technical-metrics">Technical Metrics</h3>
<ul>
<li><strong>Build Success Rate</strong>: 100% (15/15 projects must build)</li>
<li><strong>Test Pass Rate</strong>: 100% (all existing tests must pass)</li>
<li><strong>Zero Regression</strong>: No new compilation errors or runtime exceptions</li>
</ul>
<h3 id="process-metrics">Process Metrics</h3>
<ul>
<li><strong>Automation Coverage</strong>: 95%+ of changes automated</li>
<li><strong>Manual Intervention</strong>: Minimal manual fixes required</li>
<li><strong>Documentation Quality</strong>: Complete migration log</li>
</ul>
<h2 id="post-migration-recommendations">Post-Migration Recommendations</h2>
<h3 id="immediate-actions">Immediate Actions</h3>
<ol>
<li><strong>Security Assessment</strong>: Address SQL injection vulnerabilities (separate task)</li>
<li><strong>Dependency Updates</strong>: Consider upgrading Entity Framework to 6.4+</li>
<li><strong>Code Modernization</strong>: Implement proper error handling and logging</li>
</ol>
<h3 id="long-term-improvements">Long-term Improvements</h3>
<ol>
<li><strong>Migration to .NET Core/.NET 5+</strong>: Plan future framework upgrade</li>
<li><strong>Dependency Injection</strong>: Replace static DataHelper with proper DI</li>
<li><strong>Repository Pattern</strong>: Implement proper data access patterns</li>
</ol>
<h2 id="dependencies-and-prerequisites">Dependencies and Prerequisites</h2>
<h3 id="tools-required">Tools Required</h3>
<ul>
<li>NuGet CLI</li>
<li>MSBuild or Visual Studio</li>
<li>Git for version control</li>
<li>VSTest.Console for test execution</li>
</ul>
<h3 id="environment-requirements">Environment Requirements</h3>
<ul>
<li>.NET Framework 4.8 installed</li>
<li>Visual Studio or Build Tools</li>
<li>SQL Server LocalDB for testing</li>
</ul>
<h3 id="team-prerequisites">Team Prerequisites</h3>
<ul>
<li>Access to modify all 15 repositories</li>
<li>Build server access for CI/CD validation</li>
<li>Database access for integration testing</li>
</ul> </div>  </main> <footer data-astro-cid-37fxchfa> <p data-astro-cid-37fxchfa>Â© 2024 Sourcegraph. Supplemental to the <a href="https://ampcode.com/manual" data-astro-cid-37fxchfa>Amp Manual</a>.</p> </footer> </body></html> 